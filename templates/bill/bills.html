{% extends "body.html" %}

{% block title %}
    <title>Счета</title>
{% endblock %}

{% block content %}
    {% if bills %}
        <p><a class="btn btn-default" href={% url 'bill:billtransact' %}>Переводы</a></p>
        <div class="table-responsive">
            <table class="table table-striped">
                <tr>
                    <td>Счёт №</td>
                    <td>Баланс</td>
                    <td></td>
                </tr>
                {% for b in bills %}
                    <tr>
                        <td>{{ b.id }}</td>
                        <td>{{ b.value_in_currency }}</td>
                        <td>
                            <a href={% url 'bill:cardsinbill' pk=b.id %}>Карточки</a>
                            <a data-toggle="modal" data-target="#myModalOperations" data-billid="{{ b.id }}">
                                Завершённый операции</a>

                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
        <div class="modal fade" id="myModalOperations" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span>×</span></button>
                        <h4 class="modal-title">Операции</h4>
                    </div>
                    <div class="modal-body">
                        <div>
                            <table id="billoperations" class="table table-striped">
                                <tr>
                                    <td>Тип операции</td>
                                    <td>Дата</td>
                                    <td>Сумма</td>
                                </tr>
                            </table>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            $('#myModalOperations').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                $(this).find('#messageinMessage').text(button.data('message'));
                $(this).find('#headerinMessage').val(button.data('header'));
                $(this).find('#messageid').val(button.data('messageid'));
                $.post('/actions/bill/', {'num': button.data('billid')}, function (data) {
                    operations = data['operations'];
                    money = data['money'];
                    dates = data['dates'];
                    $('#billoperations').empty();
                    $('#billoperations').append('<tr><td>Тип операции</td><td>Дата</td><td>Сумма</td></tr>');
                    for (i in operations)
                        $('#billoperations').append('<tr> <td>' + operations[i] + '</td>' +
                                '  <td>' + dates[i] + ' </td>  <td>' + money[i] + '</td> </tr>')
                });
            });
        </script>

    {% else %}
        <h2>Счетов нет.</h2>
    {% endif %}
{% endblock %}


